<nb-layout>
  <nb-layout-column>
    <div class="header" [class.search-opened-mobile]="searchIsActive" [class.location-opened-mobile]="setLocationActive">
      <div class="close-location-mobile" *ngIf="setLocationActive && !searchIsActive" (click)="onSetLocationBtn()">
        <img src="assets/images/left-arrow-mobile.svg">
        Вийти з вибору локації
      </div>
      <div class="logo"><a href="/"><img src="/assets/nomos.png"></a></div>
      <div class="tooltip-for-set-location" *ngIf="setLocationActive">Оберіть локацію на карті</div>
      <div class="right">
        <svg class="search" *ngIf="!searchIsActive && containerMode == 1" width="18" height="18" viewBox="0 0 18 18" (click)="onSearch()">
          <path
            d="M7.69765 15.3945C9.40555 15.3941 11.0642 14.8224 12.4096 13.7704L16.6394 18L18 16.6395L13.7701 12.4099C14.8228 11.0645 15.3949 9.40549 15.3953 7.69724C15.3953 3.45318 11.9419 0 7.69765 0C3.45336 0 0 3.45318 0 7.69724C0 11.9413 3.45336 15.3945 7.69765 15.3945ZM7.69765 1.92431C10.8816 1.92431 13.4709 4.51347 13.4709 7.69724C13.4709 10.881 10.8816 13.4702 7.69765 13.4702C4.51371 13.4702 1.92441 10.881 1.92441 7.69724C1.92441 4.51347 4.51371 1.92431 7.69765 1.92431Z"
            fill="black" />
        </svg>
        <input *ngIf="searchIsActive && containerMode == 1" class="search-input" #searchInput type="text" placeholder="Введіть Адресу або кадастровий номер" (keyup.enter)="searchLocation(searchInput.value)">
        <svg width="25" height="16" viewBox="0 0 25 16" *ngIf="!menuIsOpen && !searchIsActive" (click)="openMenu()">
          <rect x="4" width="17" height="2" fill="#232323"/>
          <rect y="7" width="25" height="2" fill="#232323"/>
          <rect x="3" y="14" width="19" height="2" fill="#232323"/>
        </svg>
        <svg width="21" height="17" viewBox="0 0 21 17" *ngIf="menuIsOpen || searchIsActive" (click)="closeSidebar()">
          <rect x="2.36829" y="14.8492" width="21" height="2" transform="rotate(-45 2.36829 14.8492)" fill="#232323" />
          <rect x="3.78247" width="21" height="2" transform="rotate(45 3.78247 0)" fill="#232323" />
        </svg>
      </div>
    </div>
    <div class="container">
      <div class="map-wrap" [hidden]="containerMode != 1">
        <div #gmap class="map"></div>
        <div class="noise-info-wrap" *ngIf="showLocationInfo">
          <div class="noise-info-container">
            <div class="coords">
              <img src="assets/images/white-marker-small.svg">
              {{markerCoords.lat}}, {{markerCoords.lng}}
            </div>
            <div *ngFor="let item of noiseInfo; index as i" class="item-wrap">
              <div class="item" [class.no-data]="item.noData" (click)="changeMapLayer(i + 1)">
                <div class="top">
                  <img src="{{ item.src }}">
                  <span>{{ item.value }}</span>
                </div>
                <div class="bottom">
                  {{ item.text }}
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="noise-control-wrap" (click)="onNoiseInfo()">
          <div class="hight">75-85</div>
          <div class="medium">65-75</div>
          <div class="low">50-65</div>
          <div class="info">info</div>
        </div>

        <div class="layer-info-wrap" *ngIf="selectedLayerInfo">
          <img src="{{ selectedLayerInfo.src }}">
          <span class="white-shadow-text">{{ selectedLayerInfo.text }}</span>
        </div>

        <div class="scale-button">
          <div class="top" (click)="zoomIn()"></div>
          <div class="bottom" (click)="zoomOut()"></div>
        </div>

        <div class="set-location-wrap" (click)="onSetLocationBtn()" [class.location-is-selected]="showLocationInfo" [class.hide-in-mobile]="setLocationActive">
          <img src="{{ setLocationActive ? 'assets/images/left-arrow.svg' : 'assets/images/blue-marker.svg' }}">
          <span>{{ setLocationActive ? 'Вийти з Вибору локації' : 'Вибрати локацію' }}</span>
        </div>
      </div>

      <div class="post-wrap" *ngIf="containerMode == 2 && post">
        <div class="title">{{ post.title }}</div>
        <div class="body">
          <div [innerHTML]="post.text | sanitizeHtml"></div>
          <div class="date">{{ post.addedDate | date: 'dd.MM.yyyy' }}</div>
        </div>
        <div class="back-to-map" [routerLink]="''">Повернутися до карти</div>
      </div>

      <app-toast [type]="toastType" *ngIf="toastIsShowed" [@if-opacity]></app-toast>
      
      <div class="sidebar" *ngIf="menuIsOpen">
        <div class="list">
          <div class="list-item">
            <div class="head" (click)="toggleListItem(1)">
              Умовні позначення
              <div class="arrow-up arrow" *ngIf="listItemIsOpen == 1; else arrowDown"></div>
            </div>
            <div class="body" *ngIf="listItemIsOpen == 1" [@if-slide]>
              <div class="body-item kadastr-map">
                <div class="row">
                  <label class="switch">
                    <input type="checkbox" [(ngModel)]="isKadastrLayer" (change)="toggleKadastr(isKadastrLayer)" />
                    <span class="toggle"></span>
                  </label>
                  <span class="toggle-active" [class.is-active]="isKadastrLayer">
                    <img src="assets/images/map-icon.svg">
                    Кадастрова карта України
                  </span>
                </div>
              </div>
              <div class="body-item noise-maps">
                <div class="title">Карти шуму</div>
                <div class="row">
                  <label class="radio-wrap">
                    <input type="radio" name="noise-map" [value]="1" [(ngModel)]="selectedLayer" (change)="changeMapLayer()">
                    <span class="radio"></span>
                  </label>
                  <span class="toggle-active" [class.is-active]="selectedLayer == 1">
                    <img src="assets/images/day-equivalent.svg">
                    Денний Еквівалентний
                  </span>
                </div>
                <div class="row">
                  <label class="radio-wrap">
                    <input type="radio" name="noise-map" [value]="2" [(ngModel)]="selectedLayer" (change)="changeMapLayer()">
                    <span class="radio"></span>
                  </label>
                  <span class="toggle-active" [class.is-active]="selectedLayer == 2">
                    <img src="assets/images/day-max.svg">
                    Денний Максимальний
                  </span>
                </div>
                <div class="row">
                  <label class="radio-wrap">
                    <input type="radio" name="noise-map" [value]="3" [(ngModel)]="selectedLayer" (change)="changeMapLayer()">
                    <span class="radio"></span>
                  </label>
                  <span class="toggle-active" [class.is-active]="selectedLayer == 3">
                    <img src="assets/images/night-equivalent.svg">
                    Нічний Еквівалентний
                  </span>
                </div>
                <div class="row">
                  <label class="radio-wrap">
                    <input type="radio" name="noise-map" [value]="4" [(ngModel)]="selectedLayer" (change)="changeMapLayer()">
                    <span class="radio"></span>
                  </label>
                  <span class="toggle-active" [class.is-active]="selectedLayer == 4">
                    <img src="assets/images/night-max.svg">
                    Нічний Максимальний
                  </span>
                </div>
              </div>
            </div>
          </div>
          <div class="list-item">
            <div class="head" (click)="toggleListItem(2)">
              Портал
              <div class="arrow-up arrow" *ngIf="listItemIsOpen == 2; else arrowDown"></div>
            </div>
            <div class="body" *ngIf="listItemIsOpen == 2" [@if-slide]>
              <div class="post-title" *ngFor="let post of postMenu; index as i" (click)="openPost(post.id)">
                <span>{{ i + 1 }}. {{ post.title }}</span>
                {{ post.addedDate | date: 'dd.MM.yyyy' }}
              </div>
            </div>
          </div>
          <div class="list-item">
            <div class="head" (click)="toggleListItem(3)">
              Інформація про рівні шуму
              <div class="arrow-up arrow" *ngIf="listItemIsOpen == 3; else arrowDown"></div>
            </div>
            <div class="body" *ngIf="listItemIsOpen == 3" [@if-slide]>
              Lorem ipsum dolor sit amet consectetur adipisicing elit. Consectetur, inventore. Distinctio sunt at
              possimus consectetur molestias architecto autem vel quam voluptatem, libero, ipsum qui necessitatibus
              ratione tempora. Explicabo nisi reprehenderit reiciendis odit doloremque laboriosam maxime fuga impedit
              consequatur debitis aliquam dolorum nam quis, minus illum ab quibusdam mollitia ratione vero.
            </div>
          </div>
        </div>
        <div class="callback" (click)="openCallbackModal()">
          <svg width="16" height="14" viewBox="0 0 16 14" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M11.9999 0H4.00014C2.92584 0.0143477 1.90128 0.442536 1.15137 1.19058C0.401456 1.93861 -0.0125273 2.94538 0.00028895 3.98987V13.481C0.000196075 13.5841 0.0317102 13.6849 0.0908064 13.7705C0.149902 13.8561 0.233898 13.9226 0.332065 13.9616C0.430232 14.0005 0.538114 14.0101 0.641933 13.9892C0.745752 13.9683 0.840795 13.9177 0.914922 13.844L3.04818 11.7104H11.9999C13.0742 11.696 14.0987 11.2678 14.8486 10.5198C15.5985 9.77175 16.0125 8.76498 15.9997 7.72049V3.98987C16.0125 2.94538 15.5985 1.93861 14.8486 1.19058C14.0987 0.442536 13.0742 0.0143477 11.9999 0ZM11.9999 6.99977C11.7889 6.99977 11.5827 6.93895 11.4073 6.82501C11.2319 6.71106 11.0951 6.5491 11.0144 6.35961C10.9337 6.17013 10.9126 5.96162 10.9537 5.76046C10.9949 5.5593 11.0965 5.37453 11.2456 5.2295C11.3948 5.08447 11.5849 4.9857 11.7918 4.94569C11.9987 4.90568 12.2131 4.92621 12.408 5.0047C12.6029 5.08319 12.7695 5.21611 12.8867 5.38664C13.0039 5.55718 13.0665 5.75767 13.0665 5.96277C13.0665 6.2378 12.9541 6.50157 12.7541 6.69604C12.554 6.89052 12.2827 6.99977 11.9999 6.99977ZM9.06663 5.96277C9.06663 6.16787 9.00407 6.36836 8.88687 6.5389C8.76967 6.70943 8.60308 6.84235 8.40818 6.92084C8.21328 6.99932 7.99882 7.01986 7.79191 6.97985C7.58501 6.93983 7.39495 6.84107 7.24578 6.69604C7.09661 6.55101 6.99502 6.36624 6.95387 6.16508C6.91271 5.96392 6.93383 5.75541 7.01456 5.56593C7.09529 5.37644 7.23201 5.21448 7.40741 5.10053C7.58282 4.98659 7.78904 4.92577 8 4.92577C8.28289 4.92577 8.55419 5.03502 8.75422 5.2295C8.95425 5.42397 9.06663 5.68774 9.06663 5.96277ZM4.00014 4.92577C4.2111 4.92577 4.41733 4.98659 4.59273 5.10053C4.76814 5.21448 4.90485 5.37644 4.98558 5.56593C5.06631 5.75541 5.08743 5.96392 5.04628 6.16508C5.00512 6.36624 4.90353 6.55101 4.75436 6.69604C4.60519 6.84107 4.41514 6.93983 4.20823 6.97985C4.00133 7.01986 3.78686 6.99932 3.59196 6.92084C3.39706 6.84235 3.23048 6.70943 3.11328 6.5389C2.99607 6.36836 2.93352 6.16787 2.93352 5.96277C2.93352 5.68774 3.04589 5.42397 3.24592 5.2295C3.44596 5.03502 3.71726 4.92577 4.00014 4.92577Z" fill="#9AB2F0"/>
          </svg>
          <span>Зворотній зв'язок</span>
        </div>
      </div>

      <div class="sidebar search" *ngIf="searchIsActive">
        <div class="search-container">
          <div class="airports-list-title">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12.9624 16.0289L12.3741 16.6171C12.315 16.6762 12.242 16.7195 12.1618 16.7431C12.0816 16.7667 11.9968 16.7698 11.9151 16.7521C11.8334 16.7345 11.7574 16.6966 11.6942 16.642C11.6309 16.5875 11.5823 16.5179 11.5528 16.4396L9.83386 11.872L7.64757 13.9632L7.81264 15.6883C7.85087 16.024 7.81551 16.226 7.51278 16.5287L7.1168 16.9247C7.05613 16.9894 6.98074 17.0385 6.89704 17.0679C6.81334 17.0973 6.72378 17.1061 6.63597 17.0935C6.51245 17.0752 6.34053 17.0067 6.21944 16.7848L5.08851 14.7779C5.08011 14.7629 5.07238 14.7472 5.06531 14.7313C5.06444 14.73 5.06331 14.7289 5.06199 14.728C5.04595 14.7211 5.03031 14.7133 5.01515 14.7046L2.99791 13.5641C2.78224 13.4435 2.71661 13.274 2.69959 13.1527C2.68815 13.0712 2.69598 12.9882 2.72246 12.9103C2.74894 12.8324 2.79333 12.7618 2.85206 12.7041L3.27014 12.2861C3.49619 12.06 3.81704 11.942 4.10983 11.9767L5.80291 12.142L7.92158 9.95967L3.35986 8.24582C3.28162 8.21642 3.21201 8.16787 3.15738 8.10463C3.10275 8.04138 3.06484 7.96545 3.04713 7.88377C3.02941 7.8021 3.03245 7.71728 3.05597 7.63709C3.07949 7.55689 3.12273 7.48387 3.18175 7.42469L3.77639 6.83006C3.86101 6.74877 3.96286 6.68759 4.07437 6.65105C4.18589 6.61452 4.30419 6.60357 4.42052 6.61903L10.5425 7.21455L11.7855 5.90441C11.8739 5.80586 12.1311 5.54511 12.191 5.48523C13.4127 4.26481 14.5383 3.93203 15.2026 4.59627C15.4116 4.8053 15.7157 5.27641 15.4034 6.08185C15.2194 6.5576 14.853 7.07158 14.3147 7.60987C14.2555 7.66909 13.9954 7.92563 13.8955 8.01535L12.5852 9.25765L13.1738 15.3865C13.189 15.5026 13.1778 15.6206 13.1412 15.7317C13.1046 15.8429 13.0435 15.9445 12.9624 16.0289Z" fill="#1777FA"/>
            </svg>              
            Аеропорти
          </div>
          <div class="airport" *ngFor="let airport of airports" (click)="onSelectAirport(airport)">
            {{ airport.name }}
          </div>
        </div>
      </div>
    </div>
  </nb-layout-column>
</nb-layout>

<ng-template #arrowDown>
  <div class="arrow-down arrow"></div>
</ng-template>

<app-callback-modal (showToast)="showToast($event)"></app-callback-modal>